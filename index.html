
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£ä¹¦å¡ç‰‡é¢„è§ˆ - å¬éŸ³å®¡ç¾çŸ¥è¯†ä¸“æ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        /* ä¸»ä¸“æ å¡ç‰‡æ ·å¼ */
        .main-card {
            border-left: 5px solid #667eea;
        }

        .main-card .badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .main-card h1 {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .main-card .subtitle {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .intro-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 3px solid #667eea;
        }

        .intro-section h3 {
            font-size: 16px;
            color: #374151;
            margin-bottom: 12px;
        }

        .intro-section p {
            color: #6b7280;
            line-height: 1.8;
            font-size: 15px;
        }

        .points-section {
            margin: 24px 0;
        }

        .points-section h3 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .points-section ul {
            list-style: none;
            padding: 0;
        }

        .points-section li {
            padding: 12px 0 12px 32px;
            color: #374151;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
        }

        .points-section li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 18px;
        }

        .media-section {
            background: #f3f4f6;
            padding: 60px 20px;
            border-radius: 12px;
            text-align: center;
            margin: 24px 0;
            color: #9ca3af;
            font-size: 14px;
        }

        .media-section:before {
            content: "ğŸµ";
            display: block;
            font-size: 48px;
            margin-bottom: 12px;
        }

        .comment-section {
            background: #fef3c7;
            padding: 16px 20px;
            border-radius: 12px;
            margin-top: 24px;
            border: 1px solid #fcd34d;
        }

        .comment-section p {
            color: #92400e;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .comment-input-wrapper {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .comment-section input {
            flex: 1;
            padding: 12px;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            font-size: 14px;
        }

        .comment-submit-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .comment-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .comment-submit-btn:active {
            transform: translateY(0);
        }

        .comment-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .comments-list {
            margin-top: 24px;
        }

        .comments-list-title {
            font-size: 16px;
            color: #374151;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-count {
            color: #6b7280;
            font-weight: normal;
            font-size: 14px;
        }

        .comment-item {
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .comment-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }

        .comment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .comment-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .comment-user-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }

        .comment-time {
            color: #9ca3af;
            font-size: 12px;
        }

        .comment-content {
            color: #374151;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .comment-actions {
            display: flex;
            gap: 8px;
        }

        .like-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            color: #6b7280;
        }

        .like-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .like-btn.liked {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #ef4444;
        }

        .like-btn.liked:hover {
            background: #fee2e2;
        }

        .like-icon {
            font-size: 16px;
        }

        .empty-comments {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }

        /* å¾®çŸ¥è¯†å¡ç‰‡æ ·å¼ */
        .micro-card {
            border-left: 5px solid #10b981;
        }

        .micro-card .badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .micro-card h2 {
            font-size: 24px;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .micro-card .theme {
            color: #059669;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .knowledge-section {
            background: #ecfdf5;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 3px solid #10b981;
        }

        .knowledge-section h3 {
            font-size: 16px;
            color: #065f46;
            margin-bottom: 12px;
        }

        .knowledge-section p {
            color: #047857;
            line-height: 1.8;
            font-size: 15px;
        }

        .quiz-section {
            margin: 24px 0;
        }

        .quiz-section h3 {
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 16px;
        }

        .quiz-question {
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .quiz-question p {
            color: #374151;
            font-size: 15px;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 14px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option:hover {
            border-color: #10b981;
            background: #f0fdf4;
        }

        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .option.wrong {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .option .check {
            color: #10b981;
            font-weight: bold;
        }

        .option .retry {
            color: #ef4444;
            font-size: 12px;
        }

        /* ç™»å½•æ¨¡æ€æ¡†æ ·å¼ */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active {
            display: flex;
        }

        .login-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .login-modal-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-modal-header h2 {
            font-size: 28px;
            color: #1f2937;
            margin-bottom: 12px;
        }

        .login-modal-header p {
            color: #6b7280;
            font-size: 15px;
        }

        .login-form-group {
            margin-bottom: 24px;
        }

        .login-form-group label {
            display: block;
            color: #374151;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .login-form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-form-group input.error {
            border-color: #ef4444;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .login-submit-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .login-submit-btn:active {
            transform: translateY(0);
        }

        .login-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-tips {
            margin-top: 20px;
            padding: 16px;
            background: #f0f9ff;
            border-radius: 12px;
            border-left: 3px solid #3b82f6;
        }

        .login-tips p {
            color: #1e40af;
            font-size: 13px;
            line-height: 1.6;
        }

        /* ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º */
        .user-info-bar {
            background: white;
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .user-info-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .user-info-text {
            display: flex;
            flex-direction: column;
        }

        .user-info-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 15px;
        }

        .user-info-badge {
            color: #6b7280;
            font-size: 12px;
        }

        .logout-btn {
            padding: 8px 20px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            color: #6b7280;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 640px) {
            body {
                padding: 20px 10px;
            }

            .card {
                padding: 24px;
            }

            .main-card h1 {
                font-size: 22px;
            }

            .micro-card h2 {
                font-size: 20px;
            }

            .login-modal-content {
                padding: 30px 24px;
            }

            .user-info-bar {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="login-modal active" id="loginModal">
        <div class="login-modal-content">
            <div class="login-modal-header">
                <h2>æ¬¢è¿æ¥åˆ°å¬éŸ³å®¡ç¾çŸ¥è¯†ä¸“æ </h2>
                <p>è¯·è¾“å…¥æ‚¨çš„é£ä¹¦è´¦å·åå­—ï¼Œå¼€å§‹å®åç­”é¢˜è·å–ç§¯åˆ†</p>
            </div>
            <form id="loginForm">
                <div class="login-form-group">
                    <label for="userName">é£ä¹¦è´¦å·åå­— *</label>
                    <input
                        type="text"
                        id="userName"
                        name="userName"
                        placeholder="è¯·è¾“å…¥æ‚¨çš„é£ä¹¦è´¦å·åå­—"
                        required
                        autocomplete="name"
                    >
                    <div class="error-message" id="userNameError">è¯·è¾“å…¥æœ‰æ•ˆçš„åå­—ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰</div>
                </div>
                <button type="submit" class="login-submit-btn" id="loginSubmitBtn">
                    å¼€å§‹ä½¿ç”¨
                </button>
                <div class="login-tips">
                    <p>æç¤ºï¼šæ‚¨çš„åå­—å°†ç”¨äºè¯„è®ºå’Œç­”é¢˜è®°å½•ï¼Œç¡®ä¿ç§¯åˆ†æ­£ç¡®ç»Ÿè®¡</p>
                </div>
            </form>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¿¡æ¯æ  -->
    <div class="user-info-bar" id="userInfoBar" style="display: none;">
        <div class="user-info-left">
            <div class="user-info-avatar" id="userAvatar">å¼ </div>
            <div class="user-info-text">
                <div class="user-info-name" id="userDisplayName">å¼ æ˜å¾·</div>
                <div class="user-info-badge">å®åè®¤è¯ç”¨æˆ·</div>
            </div>
        </div>
        <button class="logout-btn" id="logoutBtn">é€€å‡ºç™»å½•</button>
    </div>

    <div class="container">
        <!-- å¾®çŸ¥è¯†å¡ç‰‡ï¼ˆå‘¨åº¦ï¼‰ -->
        <div class="card micro-card">
            <span class="badge">æ¯å‘¨å¾®çŸ¥è¯†</span>
            <h2>å¬éŸ³å¾®çŸ¥è¯†ï½œç¬¬1å‘¨</h2>
            <p class="theme">ä¸»é¢˜ï¼šé‡æ”¾å£°å‹çº§</p>

            <div class="knowledge-section">
                <h3>æ ¸å¿ƒçŸ¥è¯†</h3>
                <p>é‡æ”¾å£°å‹çº§æ˜¯éŸ³é¢‘é¢†åŸŸçš„æ ¸å¿ƒå‚æ•°ï¼ŒæŒ‡ç»è¿‡è€³æœºæˆ–éŸ³ç®±ç­‰è®¾å¤‡é‡æ”¾åï¼Œåœ¨äººè€³ä½ç½®æµ‹å¾—çš„å£°éŸ³å¼ºåº¦ï¼Œå•ä½ä¸ºåˆ†è´ï¼ˆdBï¼‰ã€‚å®ƒä¸æ˜¯åŸå§‹å£°æºçš„å£°å‹çº§ï¼Œè€Œæ˜¯éŸ³é¢‘ä¿¡å·ç»è®¾å¤‡æ”¾å¤§ã€è½¬æ¢åçš„è¾“å‡ºå¼ºåº¦ã€‚å£°å‹çº§æ˜¯ä»¥äººè€³èƒ½å¬åˆ°çš„æœ€å°å£°å‹ä¸ºåŸºå‡†è®¡ç®—çš„å¯¹æ•°å€¼ã€‚85dBæ˜¯é•¿æ—¶é—´è†å¬çš„å®‰å…¨é˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªå¼ºåº¦å¯èƒ½æŸä¼¤å¬åŠ›ï¼›è€Œ120dBå·²æ¥è¿‘ç—›è§‰é˜ˆå€¼ï¼Œä¼šé€ æˆå³æ—¶ä¼¤å®³ã€‚ä¸“ä¸šç›‘å¬é€šå¸¸æ§åˆ¶åœ¨75-85dBï¼Œæ—¢ä¿è¯å¬æ„Ÿå‡†ç¡®ï¼Œåˆä¿æŠ¤å¬åŠ›å¥åº·ã€‚</p>
            </div>

            <div class="quiz-section">
                <h3>äº’åŠ¨é—®é¢˜</h3>
                <div class="quiz-question">
                    <p>åœ¨è¿›è¡Œæ—¥å¸¸å¬éŸ³è®­ç»ƒæˆ–æ··éŸ³ç»ƒä¹ æ—¶ï¼Œä¸ºä»€ä¹ˆå»ºè®®å°†é‡æ”¾å£°å‹çº§æ§åˆ¶åœ¨ 75â€“85 dB ä¹‹é—´ï¼Ÿ</p>
                    <div class="quiz-options" id="quizOptions">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== é…ç½® ====================
        const API_BASE_URL = 'http://localhost:10000/api';

        // ==================== å·¥å…·å‡½æ•° ====================

        // è·å–ç”¨æˆ·åé¦–å­—
        function getFirstChar(name) {
            return name.charAt(0);
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            alert(message);
        }

        // ==================== ç”¨æˆ·ç®¡ç†åŠŸèƒ½ ====================

        // ç”¨æˆ·ä¿¡æ¯å¯¹è±¡
        let currentUser = {
            name: '',
            id: ''
        };

        // ä» localStorage åŠ è½½ç”¨æˆ·ä¿¡æ¯
        function loadUserFromStorage() {
            const savedUser = localStorage.getItem('feishu_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    return true;
                } catch (e) {
                    console.error('è§£æç”¨æˆ·ä¿¡æ¯å¤±è´¥:', e);
                    return false;
                }
            }
            return false;
        }

        // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° localStorage
        function saveUserToStorage(userName) {
            currentUser = {
                name: userName,
                id: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            };
            localStorage.setItem('feishu_user', JSON.stringify(currentUser));
        }

        // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯
        function clearUserFromStorage() {
            localStorage.removeItem('feishu_user');
            currentUser = {
                name: '',
                id: ''
            };
        }

        // éªŒè¯ç”¨æˆ·å
        function validateUserName(name) {
            const trimmedName = name.trim();
            if (trimmedName.length < 2) {
                return { valid: false, message: 'è¯·è¾“å…¥æœ‰æ•ˆçš„åå­—ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰' };
            }
            if (trimmedName.length > 20) {
                return { valid: false, message: 'åå­—ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦' };
            }
            return { valid: true, message: '' };
        }

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯æ 
        function showUserInfo() {
            const userInfoBar = document.getElementById('userInfoBar');
            const userAvatar = document.getElementById('userAvatar');
            const userDisplayName = document.getElementById('userDisplayName');

            userAvatar.textContent = getFirstChar(currentUser.name);
            userDisplayName.textContent = currentUser.name;
            userInfoBar.style.display = 'flex';
        }

        // éšè—ç”¨æˆ·ä¿¡æ¯æ 
        function hideUserInfo() {
            const userInfoBar = document.getElementById('userInfoBar');
            userInfoBar.style.display = 'none';
        }

        // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
        function showLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.add('active');
        }

        // éšè—ç™»å½•æ¨¡æ€æ¡†
        function hideLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.remove('active');
        }

        // å¤„ç†ç™»å½•è¡¨å•æäº¤
        function handleLogin(event) {
            event.preventDefault();

            const userNameInput = document.getElementById('userName');
            const errorMessage = document.getElementById('userNameError');
            const submitBtn = document.getElementById('loginSubmitBtn');
            const userName = userNameInput.value.trim();

            // éªŒè¯ç”¨æˆ·å
            const validation = validateUserName(userName);

            if (!validation.valid) {
                userNameInput.classList.add('error');
                errorMessage.textContent = validation.message;
                errorMessage.classList.add('show');
                return;
            }

            // æ¸…é™¤é”™è¯¯çŠ¶æ€
            userNameInput.classList.remove('error');
            errorMessage.classList.remove('show');

            // ç¦ç”¨æŒ‰é’®
            submitBtn.disabled = true;
            submitBtn.textContent = 'ç™»å½•ä¸­...';

            // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
            saveUserToStorage(userName);

            // æ¨¡æ‹Ÿç™»å½•å»¶è¿Ÿ
            setTimeout(() => {
                // éšè—ç™»å½•æ¨¡æ€æ¡†
                hideLoginModal();

                // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯æ 
                showUserInfo();

                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                showNotification(`æ¬¢è¿ï¼Œ${currentUser.name}ï¼`);

                // é‡ç½®æŒ‰é’®çŠ¶æ€
                submitBtn.disabled = false;
                submitBtn.textContent = 'å¼€å§‹ä½¿ç”¨';

                // æ¸…ç©ºè¾“å…¥æ¡†
                userNameInput.value = '';

                // åŠ è½½å†…å®¹
                loadQuiz();
            }, 500);
        }

        // å¤„ç†é€€å‡ºç™»å½•
        function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                // æ¸…é™¤ç”¨æˆ·ä¿¡æ¯
                clearUserFromStorage();

                // éšè—ç”¨æˆ·ä¿¡æ¯æ 
                hideUserInfo();

                // æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
                showLoginModal();
            }
        }

        // ==================== äº’åŠ¨é—®é¢˜åŠŸèƒ½ ====================

        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç­”é¢˜
        function hasUserAnsweredQuiz(quizId) {
            const key = `quiz_${quizId}_${currentUser.id}`;
            return localStorage.getItem(key) !== null;
        }

        // ä¿å­˜ç”¨æˆ·ç­”é¢˜è®°å½•
        function saveUserQuizAnswer(quizId, selectedOption, isCorrect) {
            const key = `quiz_${quizId}_${currentUser.id}`;
            const data = {
                selectedOption: selectedOption,
                isCorrect: isCorrect,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem(key, JSON.stringify(data));
        }

        // è·å–ç”¨æˆ·ç­”é¢˜è®°å½•
        function getUserQuizAnswer(quizId) {
            const key = `quiz_${quizId}_${currentUser.id}`;
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        }

        // åŠ è½½é—®é¢˜
        async function loadQuiz() {
            try {
                const response = await fetch(`${API_BASE_URL}/quizzes/quiz_1`);
                if (!response.ok) throw new Error('åŠ è½½é—®é¢˜å¤±è´¥');

                const quiz = await response.json();
                renderQuiz(quiz);
            } catch (error) {
                console.error('åŠ è½½é—®é¢˜å¤±è´¥:', error);
                document.getElementById('quizOptions').innerHTML =
                    '<div class="empty-comments">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>';
            }
        }

        // æ¸²æŸ“é—®é¢˜
        function renderQuiz(quiz) {
            const container = document.getElementById('quizOptions');
            container.innerHTML = '';

            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»ç­”è¿‡è¿™é“é¢˜
            const hasAnswered = hasUserAnsweredQuiz(quiz.id);
            const previousAnswer = getUserQuizAnswer(quiz.id);

            if (hasAnswered && previousAnswer) {
                // æ˜¾ç¤ºå·²ç­”é¢˜çš„çŠ¶æ€
                quiz.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.dataset.label = option.label;
                    optionElement.style.cursor = 'not-allowed';
                    optionElement.style.opacity = '0.7';

                    // å¦‚æœæ˜¯ç”¨æˆ·ä¹‹å‰é€‰æ‹©çš„é€‰é¡¹ï¼Œæ˜¾ç¤ºç»“æœ
                    if (option.label === previousAnswer.selectedOption) {
                        if (previousAnswer.isCorrect) {
                            optionElement.classList.add('correct');
                            optionElement.innerHTML = `
                                <span>${option.label}. ${option.text}</span>
                                <span class="feedback"><span class="check">âœ“ æ­£ç¡®ï¼ˆå·²å®Œæˆï¼‰</span></span>
                            `;
                        } else {
                            optionElement.classList.add('wrong');
                            optionElement.innerHTML = `
                                <span>${option.label}. ${option.text}</span>
                                <span class="feedback"><span class="retry">âœ— é”™è¯¯ï¼ˆå·²å®Œæˆï¼‰</span></span>
                            `;
                        }
                    } else {
                        optionElement.innerHTML = `
                            <span>${option.label}. ${option.text}</span>
                            <span class="feedback"></span>
                        `;
                    }

                    container.appendChild(optionElement);
                });

                // æ·»åŠ æç¤ºä¿¡æ¯
                const tipElement = document.createElement('div');
                tipElement.style.cssText = 'margin-top: 16px; padding: 12px; background: #fef3c7; border-radius: 8px; color: #92400e; font-size: 14px; text-align: center;';
                tipElement.textContent = 'æ‚¨å·²å®Œæˆæœ¬é¢˜ç­”é¢˜ï¼Œæ¯äººåªèƒ½ç­”é¢˜ä¸€æ¬¡';
                container.appendChild(tipElement);

            } else {
                // å…è®¸ç­”é¢˜
                quiz.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.dataset.label = option.label;

                    optionElement.innerHTML = `
                        <span>${option.label}. ${option.text}</span>
                        <span class="feedback"></span>
                    `;

                    optionElement.addEventListener('click', () => submitQuizAnswer(quiz.id, option.label));
                    container.appendChild(optionElement);
                });
            }
        }

        // æäº¤ç­”æ¡ˆ
        async function submitQuizAnswer(quizId, selectedOption) {
            // æ£€æŸ¥æ˜¯å¦å·²ç»ç­”è¿‡é¢˜
            if (hasUserAnsweredQuiz(quizId)) {
                showNotification('æ‚¨å·²ç»å®Œæˆæœ¬é¢˜ç­”é¢˜ï¼Œæ¯äººåªèƒ½ç­”é¢˜ä¸€æ¬¡', 'warning');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/quizzes/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        quizId: quizId,
                        selectedOption: selectedOption,
                        userName: currentUser.name,
                        userId: currentUser.id
                    })
                });

                if (!response.ok) throw new Error('æäº¤å¤±è´¥');

                const result = await response.json();

                // ä¿å­˜ç”¨æˆ·ç­”é¢˜è®°å½•
                saveUserQuizAnswer(quizId, selectedOption, result.isCorrect);

                // æ˜¾ç¤ºç­”é¢˜ç»“æœ
                displayQuizResult(selectedOption, result);

                // 2ç§’åé‡æ–°æ¸²æŸ“é—®é¢˜ï¼Œæ˜¾ç¤ºå·²å®ŒæˆçŠ¶æ€
                setTimeout(() => {
                    loadQuiz();
                }, 2000);

            } catch (error) {
                console.error('æäº¤ç­”æ¡ˆå¤±è´¥:', error);
                showNotification('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // æ˜¾ç¤ºç­”é¢˜ç»“æœ
        function displayQuizResult(selectedOption, result) {
            const options = document.querySelectorAll('.option');

            // ç§»é™¤æ‰€æœ‰é€‰é¡¹çš„ç‚¹å‡»äº‹ä»¶
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.classList.remove('correct', 'wrong');
                opt.querySelector('.feedback').innerHTML = '';
            });

            // æ ‡è®°é€‰ä¸­çš„é€‰é¡¹
            const selectedElement = document.querySelector(`[data-label="${selectedOption}"]`);

            if (result.isCorrect) {
                selectedElement.classList.add('correct');
                selectedElement.querySelector('.feedback').innerHTML = '<span class="check">âœ“ æ­£ç¡®ï¼+10åˆ†</span>';
                showNotification('å›ç­”æ­£ç¡®ï¼è·å¾—8ç§¯åˆ†', 'success');
            } else {
                selectedElement.classList.add('wrong');
                selectedElement.querySelector('.feedback').innerHTML = '<span class="retry">âœ— é”™è¯¯</span>';
                showNotification('å›ç­”é”™è¯¯ï¼Œç­”æ¡ˆå·²è®°å½•', 'error');
            }
        }

        // ==================== åˆå§‹åŒ– ====================

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šç™»å½•è¡¨å•æäº¤äº‹ä»¶
            const loginForm = document.getElementById('loginForm');
            loginForm.addEventListener('submit', handleLogin);

            // ç»‘å®šé€€å‡ºç™»å½•æŒ‰é’®
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.addEventListener('click', handleLogout);

            // æ£€æŸ¥æ˜¯å¦å·²ç»ç™»å½•
            if (loadUserFromStorage()) {
                // å·²ç™»å½•ï¼Œéšè—ç™»å½•æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
                hideLoginModal();
                showUserInfo();

                // åŠ è½½å†…å®¹
                loadQuiz();
            } else {
                // æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
                showLoginModal();
            }
        });
    </script>
</body>
</html>
